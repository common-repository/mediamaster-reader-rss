/*
* jQuery Newsviewer 1.0 by Francesco De Stefano Â© 2013
* http://ulmdesign.mediamaster.eu/jq_news_viewer/
*/
(function(e){function t(t,n,r,i,s,o,u){var a=e("<a></a>").attr("href",n).attr("target",u).html(r);var f=e("<h4></h4>").append(a);var l;if(o){var c=new Date(i);var h=c.getDate();var p=c.getMonth()+1;var d=c.getFullYear();if(!isNaN(p)&&!isNaN(h)&&!isNaN(d)){l=e("<div></div>").addClass("publication-date").text(h+"/"+p+"/"+d)}else{l=e("<div></div>")}}else{l=e("<div></div>")}var v=e("<div></div>").addClass("summary").html(s);e("<div></div>").addClass("headline").append(f,l,v).appendTo(t);e("<br>").appendTo(t)}function n(t,n){if(n.mode=="default"){t.css("overflow-y","auto");e(".headline").css("position","relative");e(".headline").css("height","auto");e(".headline").css("top","0")}else if(n.mode=="rotate"){var i=0,s=0;var o=t.height()+10;e("div.headline").eq(i).css("top",0);var u=e("div.headline").length;var a;var f=false;var l=function(){if(!f){f=true;a=false;i=(s+1)%u;e("div.headline").eq(s).animate({top:-o},"slow",function(){e(this).css("top",o)});e("div.headline").eq(i).animate({top:0},"slow",function(){f=false;if(!a){a=setTimeout(l,n.pause)}});s=i}};if(!a){a=setTimeout(l,n.pause)}t.hover(function(){clearTimeout(a);a=false},function(){if(!a){a=setTimeout(l,250)}})}else if(n.mode=="scroller"){e(".headline").css("position","relative");e(".headline").css("height","auto");e(".headline").css("top","0");n.ticker_height=t.height();n.news_height=$container.height();n.line_count=0;n.rotate=true;t.hover(function(){n.rotate=false},function(){n.rotate=true});r(t,n)}else if(n.mode=="paginate"){t.css("overflow-y","auto");e(".headline").css("position","relative");e(".headline").css("height","auto");e(".headline").css("top","0");var c=0;var h=function(){t.find(".headline").hide().slice(c*n.numPerPage,(c+1)*n.numPerPage).show()};var p=t.find(".headline").length;var d=Math.ceil(p/n.numPerPage);var v=e('<div class="pager"></div>');for(var m=0;m<d;m++){e('<span class="page-number"></span>').text(m+1).bind("click",{newPage:m},function(t){c=t.data["newPage"];h();e(this).addClass("active").siblings().removeClass("active")}).appendTo(v).addClass("clickable")}v.prependTo(t).find("span.page-number:first").addClass("active");h()}}function r(t,n){n.line_count+=n.rotate?-2:0;e("p",t).css("top",n.line_count);if(n.line_count<-1*n.news_height){n.line_count=n.ticker_height}setTimeout(function(){r(t,n)},n.speed)}function i(e){var t=new Date(e);var n=new Date-t;if(n<=1e4){return"Just now"}var r=null;var i={millisecond:1,second:1e3,minute:60,hour:60,day:24,month:30,year:12};for(var s in i){if(n<i[s]){break}else{r=s;n=n/i[s]}}n=Math.floor(n);if(n!==1){r+="s"}return[n,r,"ago"].join(" ")}e.fn.newsviewer=function(t){return this.each(function(){e.newsviewer(this,t)})};e.newsviewer=function(r,s){var o={mode:"default",dataSource:"local",param:null,access_token:null,url:null,maxItems:10,pause:5e3,speed:50,target:"_self",includeDate:true,numPerPage:1};if(s)o=e.extend(o,s);$obj=e(r);$obj.empty();if(o.mode=="scroller"){e("<p></p>").css("position","relative").appendTo($obj)}$container=$obj;if(o.mode=="scroller"){$container=e("p",$obj)}if(o.dataSource=="local"){if(o.param!=null){for(var u=0;u<o.param.length;u++){t($container,o.param[u][0],o.param[u][1],o.param[u][2],o.param[u][3],o.includeDate,o.target)}}n($obj,o)}else if(o.dataSource=="rss"){var a=e("<div></div>").html('<h3>Loading. Please wait</h3>').addClass("news-wait").appendTo($obj);e.get(o.url,function(r){a.remove();e("rss item",r).each(function(n,r){if(n>=o.maxItems)return false;t($container,e("link",this).text(),e("title",this).text(),e("pubDate",this).text(),e("description",this).text(),o.includeDate,o.target)});n($obj,o)})}else if(o.dataSource=="twitter"){var a=e("<div></div>").html('<h3>Loading. Please wait</h3>').addClass("news-wait").appendTo($obj);var f="http://api.getmytweets.co.uk/?screenname=";f+=o.param;f+="&limit=";f+=o.maxItems;e.getJSON(f,function(t){a.remove();e.each(t.tweets,function(t,n){var r=e("<a></a>").attr("href","https://twitter.com/"+o.param).attr("target",o.target).text(n.response.substring(0,25)+"...");var i=e("<h4></h4>").append(r);var s;if(o.includeDate){s=e("<div></div>").addClass("publication-date").text(n.tweet_date)}else{s=e("<div></div>")}var u=e("<div></div>").addClass("summary").text(n.response);e("<div></div>").addClass("headline").append(i,s,u).appendTo($container);e("<br>").appendTo($container)});n($obj,o)})}else if(o.dataSource=="facebook"){var a=e("<div></div>").html('<h3>Loading. Please wait</h3>').addClass("news-wait").appendTo($obj);var f="https://graph.facebook.com/"+o.param+"/posts/?access_token="+o.access_token+"&callback=?&date_format=U&limit=";f+=o.maxItems;e.getJSON(f,function(t){a.remove();e.each(t.data,function(t,n){var r=e("<a></a>").attr("href","http://www.facebook.com/"+o.param).attr("target",o.target).text(n.message.substring(0,25)+"...");var s=e("<img />").attr("src",n.picture);var u=e("<a></a>").attr("href",n.link).attr("target",o.target).text(n.description);var a=e("<h4></h4>").append(r);var f=e("<p></p>").append(u);var l;if(o.includeDate){l=e("<div></div>").addClass("publication-date").text(i(n.created_time*1e3))}else{l=e("<div></div>")}var c=e("<div></div>").addClass("summary").text(n.message);e("<div></div>").addClass("headline").append(a,f,s,l,c).appendTo($container);e("<br>").appendTo($container)});n($obj,o)})}else if(o.dataSource=="flickr"){var a=e("<div></div>").html('<h3>Loading. Please wait</h3>').addClass("news-wait").appendTo($obj);var f="http://api.flickr.com/services/feeds/photos_public.gne?id="+o.param+"&format=json";if(o.param!=null){f+="&"}f+="jsoncallback=?";e.getJSON(f,function(t){a.remove();e.each(t.items,function(t,n){var r=e("<a></a>").attr("href",n.link).attr("target",o.target).text(n.title);var i=e("<h4></h4>").append(r);var s=e("<div></div>").addClass("publication-date").text(n.author.split("(")[1].replace(")",""));var u=e("<img>").attr("src",n.media.m);var a=e("<p></p>").text(n.published);e("<div></div>").addClass("headline").append(i,s,u,a).appendTo($container);e("<br>").appendTo($container);if(t==o.maxItems)return false});n($obj,o)})}}})(jQuery)